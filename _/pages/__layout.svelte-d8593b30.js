import{S as e,i as a,s as t,D as o,l as n,k as l,e as s,j as i,t as r,E as c,d,n as f,c as u,a as w,m as h,g as m,b as p,F as g,f as v,o as y,G as I,H as $,x as b,u as k,v as S,I as E,A as x}from"../chunks/vendor-1f1eec1c.js";import{c as R}from"../chunks/utils-798ae020.js";import{b as T}from"../chunks/paths-45dac81d.js";let A;function j(e){window.postMessage({msg:"installedStatusChange",isInstalled:e})}function N(){function e(){return"complete"===document.readyState&&(window.setTimeout((()=>location.reload()),250),!0)}e()||document.addEventListener("readystatechange",(()=>{e()}))}const O={async clearCacheAndReload(){var e,a,t,o;try{await(null==(o=null==(t=await(null==(a=null==(e=navigator.serviceWorker)?void 0:e.getRegistration)?void 0:a.call(e)))?void 0:t.unregister)?void 0:o.call(t))}catch{}await fetch(`/clear-site-data/?random=${Math.floor(1e10*Math.random())}`);for await(let n of await window.caches.keys())await window.caches.delete(n);localStorage.setItem("afterReload","reloadAgain"),N()},async installAppOrDownload(){(null==A?void 0:A.prompt)?A.prompt():(window.localStorage.setItem("afterReload","downloadFiles"),window.setTimeout((()=>location.reload())))},async preparePwa(){switch(localStorage.getItem("afterReload")){case"downloadFiles":localStorage.removeItem("afterReload"),await async function(){const e=await(async()=>{let e=await(await window.fetch("./_/filestocache.json")).json();return e=e.map((e=>new URL(e,`${location.origin}${T}/`).href)),e})(),a=await(async()=>{let e=[];for await(const a of await window.caches.keys())e=[...e,...(await(await window.caches.open(a)).keys()).map((({url:e})=>e))];return e})(),t=e.filter((e=>!a.includes(e))).map((e=>window.fetch(e)));await Promise.all(t)}();break;case"reloadAgain":JSON.parse(localStorage.getItem("isInstalled"))?localStorage.setItem("afterReload","downloadFiles"):localStorage.setItem("afterReload","reloadThirdTime"),N();break;case"reloadThirdTime":localStorage.removeItem("afterReload"),N()}window.addEventListener("beforeinstallprompt",(async e=>{e.preventDefault(),j(!1),localStorage.removeItem("isInstalled"),A=e})),window.addEventListener("appinstalled",(async e=>{j(!0),window.localStorage.setItem("afterReload","downloadFiles"),localStorage.setItem("isInstalled",JSON.stringify(!0)),window.setTimeout((()=>location.reload()))}))}};class P extends e{constructor(e){super(),a(this,e,null,null,t,{})}}function F(e){let a,t,x,T,A,j,N,F,L,B,_,D,M,U,C,J,V,G,H,W,q,z;j=new P({});const K=e[2].default,Q=o(K,e,e[1],null);return{c(){a=n(),t=l(),x=s("input"),T=l(),A=s("div"),i(j.$$.fragment),N=l(),F=s("nav"),L=s("button"),B=l(),_=s("button"),D=l(),M=s("label"),U=l(),C=s("main"),Q&&Q.c(),J=l(),V=s("footer"),G=s("span"),H=r("© 2021 Benjamin Aster"),this.h()},l(e){const o=c('[data-svelte="svelte-8pnnl9"]',document.head);a=n(),o.forEach(d),t=f(e),x=u(e,"INPUT",{type:!0,id:!0}),T=f(e),A=u(e,"DIV",{id:!0,class:!0});var l=w(A);h(j.$$.fragment,l),N=f(l),F=u(l,"NAV",{class:!0});var s=w(F);L=u(s,"BUTTON",{title:!0,class:!0}),w(L).forEach(d),B=f(s),_=u(s,"BUTTON",{title:!0,class:!0}),w(_).forEach(d),D=f(s),M=u(s,"LABEL",{for:!0,title:!0,class:!0,id:!0,tabindex:!0}),w(M).forEach(d),s.forEach(d),U=f(l),C=u(l,"MAIN",{class:!0});var i=w(C);Q&&Q.l(i),i.forEach(d),J=f(l),V=u(l,"FOOTER",{class:!0});var r=w(V);G=u(r,"SPAN",{});var p=w(G);H=m(p,"© 2021 Benjamin Aster"),p.forEach(d),r.forEach(d),l.forEach(d),this.h()},h(){p(x,"type","checkbox"),p(x,"id","theme-toggler"),x.hidden=!0,p(L,"title","pop out window"),p(L,"class","bi-box-arrow-up-right svelte-14g53aa"),p(_,"title","clear cache & reload"),p(_,"class","bi-arrow-clockwise svelte-14g53aa"),p(M,"for","theme-toggler"),p(M,"title","toggle light/dark theme"),p(M,"class","bi-moon-fill svelte-14g53aa"),p(M,"id","theme-toggler-label"),p(M,"tabindex","0"),p(F,"class","svelte-14g53aa"),p(C,"class","svelte-14g53aa"),p(V,"class","svelte-14g53aa"),p(A,"id","actual-content"),p(A,"class","svelte-14g53aa")},m(o,n){g(document.head,a),v(o,t,n),v(o,x,n),v(o,T,n),v(o,A,n),y(j,A,null),g(A,N),g(A,F),g(F,L),g(F,B),g(F,_),g(F,D),g(F,M),g(A,U),g(A,C),Q&&Q.m(C,null),g(A,J),g(A,V),g(V,G),g(G,H),W=!0,q||(z=[I(L,"click",e[3]),I(_,"click",O.clearCacheAndReload),I(M,"click",R.store)],q=!0)},p(e,[a]){Q&&Q.p&&(!W||2&a)&&$(Q,K,e,e[1],W?a:-1,null,null)},i(e){W||(b(false),b(j.$$.fragment,e),b(Q,e),W=!0)},o(e){k(false),k(j.$$.fragment,e),k(Q,e),W=!1},d(e){d(a),e&&d(t),e&&d(x),e&&d(T),e&&d(A),S(j),Q&&Q.d(e),q=!1,E(z)}}}var L=function(e,a,t,o){return new(t||(t=Promise))((function(n,l){function s(e){try{r(o.next(e))}catch(a){l(a)}}function i(e){try{r(o.throw(e))}catch(a){l(a)}}function r(e){var a;e.done?n(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(s,i)}r((o=o.apply(e,a||[])).next())}))};function B({page:e,fetch:a,session:t,context:o}){return L(this,void 0,void 0,(function*(){return{props:{renderInfo:yield(yield a("./_/info.json")).json()}}}))}function _(e,a,t){let{$$slots:o={},$$scope:n}=a;var l=this&&this.__awaiter||function(e,a,t,o){return new(t||(t=Promise))((function(n,l){function s(e){try{r(o.next(e))}catch(a){l(a)}}function i(e){try{r(o.throw(e))}catch(a){l(a)}}function r(e){var a;e.done?n(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(s,i)}r((o=o.apply(e,a||[])).next())}))};let{renderInfo:s}=a;x((()=>l(void 0,void 0,void 0,(function*(){yield async function(){await O.preparePwa(),R.setInitial()}()}))));return e.$$set=e=>{"renderInfo"in e&&t(0,s=e.renderInfo),"$$scope"in e&&t(1,n=e.$$scope)},[s,n,o,async()=>{window.open(location.href,"_blank","location=yes")}]}export default class extends e{constructor(e){super(),a(this,e,_,F,t,{renderInfo:0})}}export{B as load};
